define("tools/customEvent",[],function(){var t=0;$(window).on("scroll",function(){t||(t=setTimeout(function(){$(window).trigger("aj.scroll"),t=0},1e3/24))}),function(){function t(){new Date-e<o?setTimeout(t,o):(n=!1,$(window).trigger("aj.resize"))}var e,n=!1,o=200;$(window).resize(function(){e=new Date,n===!1&&(n=!0,setTimeout(t,o))})}()}),define("model/user",[],function(){function t(){this.conatinerSelector=".user-login",this.statusAttr="data-islogin",this.configSelector="#aj-user-sign-config",this.loginSuccessEventName="aj.userLoginSuccess",this.logoutSuccessEventName="aj.userLogoutSuccess"}return t.prototype={isLogin:function(){var t=$(this.configSelector)[0];if(!t.isLogin)return!1;try{return JSON.parse(t.isLogin.value)}catch(e){return!1}},getUserid:function(){var t=$(this.configSelector)[0];return t.userid?t.userid.value:0},getUserimg:function(){var t=$(this.configSelector)[0];return t.img?t.img.value:""},getNickname:function(){var t=$(this.configSelector)[0];return t.nickname?t.nickname.value:""},triggerLoginEvent:function(){$(window).trigger(this.loginSuccessEventName)},triggerLogoutEvent:function(){$(window).trigger(this.logoutSuccessEventName)},onLogin:function(t){$(window).on(this.loginSuccessEventName,t)},onLogout:function(t){$(window).on(this.logoutSuccessEventName,t)}},new t}),define("tools/tools",[],function(){var t={joinParams:function(t,e){for(var n=[],o=0;o<e.length;o++)n.push(e[o].key+"="+encodeURIComponent(e[o].val));return t+="?"+n.join("&")},openUrl:function(t){window.open(t,"oauth2Login_10914","height=525,width=585, toolbar=no, menubar=no, scrollbars=no, status=no, location=yes, resizable=yes")},logException:function(t){console.log("An error happen.."),console.log(t)},isLocal:function(){return"localhost"==location.hostname.toLowerCase()?!0:!1},tishi:function(t){var e=$("#aj-gobal-tishi-modal");e.find(".modal-body").html(t),e.modal("show")},timeago:function(t){return(new timeago).format(t,"zh_CN")}},e=new timeago;e.render($(".time_need_to_be_rendered"),"zh_CN");var n=$("#aj-header");return $(window).on("aj.scroll",function(){$(window).scrollTop()>100?n.addClass("mini"):n.removeClass("mini")}),t}),define("model/comment",[],function(){function t(){this.id=null,this.parentid=null,this.commentsGroupId=null,this.userid=null,this.content=null}return t.prototype={},t}),define("ui/comment",["model/user","tools/tools","model/comment"],function(t,e,n){function o(){this.className="aj-comment-ui-area",this.groupIdAttr="data-grounp-id",this.commentAreaTitleAttr="data-title-value",this.hasRenderClassName="aj-comment-ui-area-has-rendered",this.commentsLoadUrl="/comment/get",this.submitUrl="/comment/submit",this.textareaClassName="user-comment-area",this.placeHolderWhenLogin="亲, 说点什么吧~",this.placeHolderWhenLogout="登陆才可以评论哦~",this.submitBtnClassName="aj-submit-btn",this.submitErrorInfo="服务器君出现异常,请待会再试试吧~~",this.oneCommentClassName="one-comment",this.commentsWrapClassName="comments-wrap-className",this.lastCommentTimestampAttribute="data-last-comment-timestamp",this.pageSize=20,this.classNameOfBtnForNextPageComments="btn-get-next-page-comments",this.btnForNextPageCommentsPageAttribute="data-next-page"}return o.prototype={getGroupId:function(t){return t.attr(this.groupIdAttr)},getContentFromDom:function(t){return t.find("."+this.textareaClassName).val()},render:function(){var t=$("."+this.className),e=this;t.each(function(){e.renderDom(this)})},renderDom:function(t){this.hasRendered(t)||($(t).addClass(this.hasRenderClassName),this.renderHeader(t),this.renderComments(t),this.bindEvents(t))},bindEvents:function(n){var o=this;t.onLogin(function(){o.enableComment(n)}),t.onLogout(function(){o.disableComment(n)}),$(n).on("click","."+this.submitBtnClassName,function(){var t=o.validate(n);if(t!==!0)return void e.tishi(t);var a=o.getCommentFromDom(n);o.submit(a,n)}),$(n).on("click","."+this.classNameOfBtnForNextPageComments,function(){var t=parseInt($(this).attr(o.btnForNextPageCommentsPageAttribute));$(this).hide(),o.renderComments(n,t)})},validate:function(e){var n=!0,o="";return t.isLogin()?""===$.trim($(e).find("."+this.textareaClassName).val())&&(n=!1,o="内容不能为空的~~"):o="登陆后才可以评论哦~",n===!0?n:o},submit:function(t,n){var o=this,a="aj-is-ajax-now",s=$(n);s.hasClass(a)||(s.addClass(a),$.ajax({url:this.submitUrl,type:"POST",data:{data:JSON.stringify(t)},dataType:"JSON",success:function(a){a.isok?(o.renderCommentPrependDom(t,n),o.clearAfterComment(n)):e.tishi(a.data)},error:function(){e.tishi(o.submitErrorInfo)},complete:function(){s.removeClass(a)}}))},clearAfterComment:function(t){$(t).find("."+this.textareaClassName).val("")},renderCommentPrependDom:function(e,n){e.dateEnteredOfSave=new Date,e.userimg=t.getUserimg(),e.nickname=t.getNickname();var o=this.renderCommentJsonToDom(e);$(n).find("."+this.commentsWrapClassName).prepend(o)},getCommentFromDom:function(t){var e=new n;return e.commentsGroupId=this.getGroupId($(t)),e.content=this.getContentFromDom($(t)),e},disableComment:function(t){$(t).find("."+this.textareaClassName).attr({disabled:"true",placeholder:this.placeHolderWhenLogout})},enableComment:function(t){$(t).find("."+this.textareaClassName).removeAttr("disabled").attr("placeholder",this.placeHolderWhenLogin)},renderHeader:function(e){var n=$("<div>"),o=$("<h3>");textarea=$("<textarea>"),btn=$("<button>"),titleValue=$(e).attr(this.commentAreaTitleAttr),titleValue?o.html(titleValue):o.html("用户评论:"),n.append(o),t.isLogin()?textarea.attr("placeholder","说点什么呗~"):(textarea.attr("placeholder","您未登录, 无法评论"),textarea.attr("disabled","true")),textarea.addClass("form-control"),textarea.addClass(this.textareaClassName),n.append(textarea),btn.html("提交"),btn.addClass("form-control "+this.submitBtnClassName),btn.css({width:"80px"}),n.append(btn),$(e).append(n)},renderComments:function(t,e){void 0===e&&(e=1),jDom=$(t);var n=$("<div>"),o=this,a=0;n.addClass(this.commentsWrapClassName),$.ajax({url:this.commentsLoadUrl+"?commentsGroupId="+this.getGroupId(jDom)+"&page="+e,type:"GET",dataType:"json",success:function(t){var e;if(t.isok)for(a=t.data.length,t.data.sort(function(t,e){return+new Date(t.dateEnteredOfSave)>+new Date(e.dateEnteredOfSave)?-1:1}),e=0;e<t.data.length;e++)n.append(o.renderCommentJsonToDom(t.data[e]))},error:function(){n.html("加载失败"),n.css({padding:"20px",textAlign:"center"})},complete:function(){var t=$("<div>");t.css({textAlign:"center",padding:"10px"});var s=$("<a>");s.attr("href","javascript:;"),a===o.pageSize?(s.html("下一页"),s.addClass(o.classNameOfBtnForNextPageComments),s.attr(o.btnForNextPageCommentsPageAttribute,e+1)):a>o.pageSize?(s.html("下一页"),s.addClass(o.classNameOfBtnForNextPageComments),s.attr(o.btnForNextPageCommentsPageAttribute,e+2)):s.html("木有更多了"),t.append(s),jDom.append(n),jDom.append(t)}})},renderCommentJsonToDom:function(t){var n=$("<div>");return n.addClass(this.oneCommentClassName),n.css({marginTop:"10px"}),n.html('<div class="c-header"><img class="header-img" src="'+t.userimg+'"/><span class="name">'+t.nickname+'</span><span class="c-time">'+e.timeago(t.dateEnteredOfSave)+'</span></div><div class="c-content">'+t.content+"</div>"),n},hasRendered:function(t){return $(t).hasClass(this.hasRenderClassName)}},new o}),define("tools/seo",[],function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];"https"===e?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)}),define("tools/googleCustomSearch",[],function(){$(function(){setTimeout(function(){var t="004921646225264859102:l38ugphmwgg",e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://cse.google.com/cse.js?cx="+t;var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)},2e3)})}),define("model/Goods",[],function(){var t={getGoodsTypeList:function(t,e){$.ajax({url:"/t/goodsTypeList",type:"GET",dataType:"json",success:function(e){t(e)},error:function(t){e&&e(t)}})}};return t}),require(["tools/customEvent","ui/comment","model/user","tools/tools","tools/seo","tools/googleCustomSearch","model/Goods"],function(){}),define("requirejs-main",function(){});